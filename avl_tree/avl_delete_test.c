#include <stdio.h>
#include <stdlib.h>
#include <time.h>

#include "avl_tree.h"

static Node* delete_tree_node( AvlTree t, int key );
static int randomIndex();
static void loop_random_test( int array[], int size, int test_counter );
static void step_delete_test(int r);

int array[ 100 ][ 10 ] = {
 { 10, 26, 58, 40, 96, 37, 52, 29, 32, 30 },
 { 49, 60, 35, 32, 68, 14, 69, 51, 33, 47 },
 { 43, 46, 51, 69, 92, 73, 65, 41, 81, 38 },
 { 93, 59, 86, 33, 17, 76, 75, 88, 98, 95 },
 { 37, 20, 97, 62, 42, 27, 29, 64, 68, 14 },
 { 63, 12, 66, 33, 94, 39, 50, 35, 72, 79 },
 { 28, 83, 65, 13, 90, 41, 79, 92, 36, 68 },
 { 12, 85, 83, 97, 64, 23, 32, 68, 76, 86 },
 { 33, 95, 71, 27, 34, 21, 15, 59, 90, 85 },
 { 42, 56, 89, 85, 49, 30, 26, 93, 84, 96 },
 { 42, 67, 93, 96, 83, 68, 29, 52, 44, 37 },
 { 39, 38, 16, 26, 49, 21, 37, 40, 59, 31 },
 { 48, 10, 16, 49, 30, 84, 43, 38, 69, 91 },
 { 32, 88, 84, 29, 72, 14, 48, 76, 67, 65 },
 { 40, 95, 71, 18, 44, 45, 97, 36, 94, 28 },
 { 36, 56, 87, 76, 38, 71, 66, 92, 62, 89 },
 { 43, 98, 70, 67, 12, 22, 50, 37, 42, 32 },
 { 31, 12, 28, 66, 99, 17, 60, 80, 43, 68 },
 { 29, 19, 96, 90, 80, 63, 45, 42, 14, 78 },
 { 40, 74, 45, 42, 44, 71, 90, 39, 55, 21 },
 { 94, 73, 78, 93, 80, 90, 35, 76, 59, 54 },
 { 85, 55, 97, 28, 18, 42, 22, 74, 72, 15 },
 { 48, 69, 99, 44, 96, 15, 89, 36, 22, 62 },
 { 30, 48, 40, 75, 80, 31, 63, 56, 42, 69 },
 { 94, 87, 66, 22, 58, 60, 86, 32, 84, 91 },
 { 33, 53, 91, 67, 52, 49, 35, 93, 75, 47 },
 { 56, 57, 85, 86, 66, 69, 48, 74, 63, 17 },
 { 68, 51, 36, 42, 61, 48, 29, 45, 85, 72 },
 { 68, 38, 25, 88, 43, 65, 23, 36, 92, 22 },
 { 82, 50, 60, 31, 87, 78, 52, 35, 16, 94 },
 { 21, 19, 82, 15, 32, 83, 34, 67, 68, 97 },
 { 88, 96, 74, 76, 39, 51, 28, 32, 63, 62 },
 { 34, 23, 45, 21, 91, 50, 98, 96, 56, 54 },
 { 69, 27, 89, 74, 11, 72, 99, 68, 40, 58 },
 { 18, 88, 32, 46, 80, 24, 87, 98, 13, 22 },
 { 32, 78, 58, 95, 98, 93, 28, 16, 99, 87 },
 { 85, 88, 61, 86, 22, 16, 14, 70, 25, 55 },
 { 55, 23, 35, 69, 11, 85, 67, 66, 97, 51 },
 { 44, 17, 46, 66, 67, 91, 73, 90, 85, 20 },
 { 41, 47, 96, 53, 21, 65, 20, 44, 42, 89 },
 { 55, 90, 20, 18, 37, 39, 74, 86, 80, 19 },
 { 94, 78, 37, 61, 69, 36, 87, 21, 97, 52 },
 { 20, 56, 58, 32, 21, 68, 66, 53, 85, 55 },
 { 98, 75, 27, 69, 64, 56, 43, 50, 36, 14 },
 { 96, 14, 94, 20, 35, 30, 97, 46, 41, 56 },
 { 51, 52, 12, 61, 36, 75, 81, 92, 80, 66 },
 { 47, 41, 93, 26, 10, 57, 72, 43, 59, 60 },
 { 10, 56, 26, 94, 66, 51, 76, 25, 49, 69 },
 { 71, 90, 73, 36, 13, 99, 63, 84, 91, 44 },
 { 50, 90, 37, 43, 16, 52, 78, 32, 12, 58 },
 { 16, 78, 76, 19, 54, 91, 59, 24, 62, 11 },
 { 87, 50, 15, 14, 89, 78, 48, 92, 31, 75 },
 { 87, 37, 64, 40, 68, 48, 94, 58, 71, 14 },
 { 27, 11, 80, 36, 56, 71, 47, 32, 85, 19 },
 { 36, 68, 58, 92, 57, 89, 11, 20, 29, 47 },
 { 83, 81, 15, 31, 75, 64, 54, 79, 43, 56 },
 { 59, 69, 64, 82, 86, 29, 70, 95, 17, 38 },
 { 16, 99, 47, 95, 91, 49, 15, 20, 90, 52 },
 { 55, 71, 20, 77, 46, 36, 83, 69, 91, 38 },
 { 55, 70, 59, 41, 89, 29, 13, 19, 95, 58 },
 { 57, 90, 12, 58, 95, 22, 10, 99, 30, 71 },
 { 19, 59, 69, 45, 42, 98, 14, 34, 95, 79 },
 { 56, 54, 73, 97, 36, 62, 45, 57, 67, 99 },
 { 69, 12, 56, 43, 17, 63, 35, 27, 22, 24 },
 { 55, 54, 81, 41, 40, 38, 72, 48, 82, 45 },
 { 46, 18, 97, 54, 16, 21, 60, 67, 80, 25 },
 { 23, 24, 27, 31, 39, 15, 10, 52, 76, 59 },
 { 68, 57, 52, 60, 47, 24, 99, 30, 97, 90 },
 { 19, 51, 58, 26, 63, 45, 95, 34, 59, 13 },
 { 42, 11, 70, 94, 15, 84, 32, 26, 14, 68 },
 { 64, 79, 82, 25, 99, 42, 22, 52, 14, 10 },
 { 30, 27, 71, 65, 22, 95, 76, 84, 61, 70 },
 { 47, 31, 26, 52, 15, 49, 68, 71, 81, 36 },
 { 36, 60, 70, 13, 22, 65, 26, 69, 80, 78 },
 { 51, 59, 50, 68, 33, 97, 69, 58, 67, 16 },
 { 80, 46, 58, 47, 85, 78, 19, 28, 14, 97 },
 { 40, 37, 10, 52, 92, 78, 30, 61, 58, 99 },
 { 64, 69, 11, 32, 93, 98, 29, 24, 19, 49 },
 { 31, 89, 85, 41, 88, 32, 20, 97, 12, 76 },
 { 56, 42, 13, 57, 47, 95, 87, 67, 18, 46 },
 { 28, 34, 67, 29, 57, 22, 80, 38, 37, 89 },
 { 77, 58, 40, 24, 89, 28, 98, 61, 78, 10 },
 { 38, 34, 43, 41, 42, 89, 31, 61, 59, 29 },
 { 80, 84, 86, 61, 93, 31, 88, 82, 98, 74 },
 { 75, 49, 93, 36, 11, 71, 91, 57, 31, 84 },
 { 91, 25, 73, 22, 77, 85, 41, 57, 31, 79 },
 { 70, 24, 40, 26, 97, 28, 98, 58, 78, 35 },
 { 86, 28, 22, 81, 51, 10, 72, 98, 84, 56 },
 { 89, 99, 82, 63, 76, 29, 94, 85, 50, 74 },
 { 18, 26, 14, 34, 23, 85, 84, 63, 19, 72 },
 { 43, 89, 46, 76, 40, 10, 91, 82, 57, 42 },
 { 82, 91, 96, 20, 90, 58, 22, 26, 66, 83 },
 { 90, 65, 68, 36, 89, 83, 46, 23, 79, 87 },
 { 59, 55, 80, 96, 56, 71, 78, 65, 13, 22 },
 { 18, 61, 33, 80, 52, 81, 92, 30, 99, 44 },
 { 13, 51, 99, 71, 77, 17, 75, 64, 86, 63 },
 { 24, 93, 43, 72, 49, 14, 12, 66, 69, 25 },
 { 74, 31, 10, 54, 35, 43, 98, 17, 42, 21 },
 { 45, 42, 44, 22, 51, 88, 99, 89, 75, 83 },
 { 84, 47, 50, 13, 71, 27, 77, 54, 79, 41 }
};


int main(int argc, char const *argv[])
{
    int i, j;
    printf( "sizeof( array ) / sizeof( array[0] ) = %ld\n", sizeof( array ) / sizeof( array[0] ) );
    printf( " sizeof( array[0] ) / sizeof( int ) = %ld\n",  sizeof( array[ 0 ] ) / sizeof( int ) );

    for( i = 0; i < sizeof( array ) / sizeof( array[0] ); i++ ) {
        loop_random_test( array[ i ], sizeof( array[i] ) / sizeof( int ), 100 );
    }

    //loop_random_test( array[ 5 ], 10, 1000 );

	//step_delete_test( 5 );
	return 0;
}

static void step_delete_test( int r )
{
    AvlTree t = NULL;
    int i;
    for ( i = 0; i < 10; i++ ) {
        t = insert_avltree( t, array[ r ][ i ] );
        printf( "[Main]\n" );
        print_avltree( t, t -> key , 0 );
        printf( "\n" );
    }

    printf("========================\n");

    t = delete_tree_node( t, 35 );
    t = delete_tree_node( t, 71 );
    t = delete_tree_node( t, 89 );
    // t = delete_tree_node( t, 99 );
    // t = delete_tree_node( t, 17 );
    // t = delete_tree_node( t, 57 );
    // t = delete_tree_node( t, 73 );
    // t = delete_tree_node( t, 33 );
    // t = delete_tree_node( t, 37 );
    // t = delete_tree_node( t, 37 );
    // t = delete_tree_node( t, 65 );

    destroy_avltree( t );
}



static void loop_random_test( int array[], int size, int test_counter )
{

	srand( time( NULL ) );

	int i, counter = 0;
	do {

		printf("Test case [%d]\n", counter );

        AvlTree t = NULL;
        for ( i = 0; i < size; i++ ) {
            t = insert_avltree( t, array[ i ] );
            printf( "[Main]\n" );
            print_avltree( t, t -> key , 0 );
            printf( "\n" );
        }

        while ( t != NULL ) {
            int idx = randomIndex();
            int key = array[ idx ];
            printf( "idx = %d, key = %d\n", idx, key );
            t = delete_tree_node( t, key );
        }

        counter++;


	} while ( counter < test_counter );

	printf( "\n\n%s\n\n", "Well done!");

}


static int randomIndex()
{
	return rand() % 10;
}

static Node* delete_tree_node( AvlTree t, int key )
{

    if( NULL == t ) return NULL;

    printf( "===============================> Before delete Node( %d )\n", key );
    print_avltree( t, t -> key, 0 );

    t = delete_avltree( t, key );
    printf( "===============================> After delete Node( %d ):\n", key );
    if ( NULL != t )
        print_avltree(t, t -> key, 0 );
    else
        printf( "the AvlTree is empty!\n" );

    return t;
}
